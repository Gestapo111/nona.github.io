<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evaluación: Ácidos, Bases y Soluciones Buffer</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h2 { text-align: center; }
        .question { margin-bottom: 20px; }
        .hidden { display: none; }
        .modal {
            display: block;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            padding-top: 60px;
        }
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
        }
        .modal-header, .modal-footer {
            padding: 10px;
            background-color: #5cb85c;
            color: white;
        }
        #timerModal {
            position: fixed;
            z-index: 2;
            top: 10px;
            right: 10px;
            background-color: black;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
        }
        #timerText {
            color: green;
            font-size: 20px;
        }
        #resultModal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.9);
            padding-top: 60px;
        }
        #resultContent {
            background-color: black;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 60%;
            color: green;
            font-size: 18px;
        }
        #resultContent p { margin: 10px 0; }
        #lockModal {
            display: none;
            position: fixed;
            z-index: 3;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.9);
            padding-top: 60px;
        }
        #lockContent {
            background-color: black;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 60%;
            color: red;
            font-size: 24px;
            text-align: center;
        }
    </style>
</head>
<body>

<div id="nameModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Ingrese su Información</h2>
        </div>
        <div class="modal-body">
            <label for="studentName">Nombre Completo:</label>
            <input type="text" id="studentName" required><br><br>
            <label for="studentNIE">NIE:</label>
            <input type="text" id="studentNIE" required><br><br>
            <button onclick="startExam()">Iniciar Evaluación</button>
        </div>
    </div>
</div>

<h2>Evaluación: Ácidos, Bases y Soluciones Buffer</h2>

<form id="quizForm">
    <div id="questionsContainer">
        <!-- Las preguntas se insertarán aquí mediante JavaScript -->
    </div>
    <button type="button" onclick="submitQuiz()">Obtener Calificación</button>
</form>

<div id="timerModal">
    <span id="timerText">30:00</span>
</div>

<div id="resultModal" class="modal">
    <div id="resultContent">
        <p>Fecha y hora: <span id="resultDate"></span></p>
        <p>Tiempo en realizar la prueba: <span id="resultTime"></span></p>
        <p>Nombre de la unidad: Ácidos, Bases y Soluciones Buffer</p>
        <p>Nombre del estudiante: <span id="resultName"></span></p>
        <p>NIE del estudiante: <span id="resultNIE"></span></p>
        <p>Calificación obtenida en base a 10: <span id="resultScore"></span></p>
        <p>Preguntas incorrectas: <span id="incorrectQuestions"></span></p>
        <button onclick="closeResult()">Cerrar</button>
    </div>
</div>

<div id="lockModal" class="modal">
    <div id="lockContent">
        Bloqueado por múltiples intentos
    </div>
</div>

<script>
    const questions = [
        {
            question: "¿Cuál de las siguientes afirmaciones describe correctamente un ácido fuerte?",
            answers: [
                "Es un ácido que se disocia completamente en solución acuosa.",
                "Es un ácido que se disocia parcialmente en solución acuosa.",
                "Es un ácido que no se disocia en solución acuosa.",
                "Es un ácido que se disocia completamente en soluciones orgánicas."
            ],
            correct: 0
        },
        // Agrega más preguntas aquí
    ];

    let startTime, endTime;
    let modificationCounts = {};  // Objeto para almacenar el conteo de modificaciones por pregunta
    const maxModifications = 2;

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    function startExam() {
        const studentName = document.getElementById('studentName').value;
        const studentNIE = document.getElementById('studentNIE').value;
        if (!studentName || !studentNIE) {
            alert("Por favor, complete toda la información.");
            return;
        }

        document.getElementById('nameModal').style.display = 'none';
        document.getElementById('resultName').innerText = studentName;
        document.getElementById('resultNIE').innerText = studentNIE;

        shuffleArray(questions);
        questions.forEach((q, index) => {
            shuffleArray(q.answers);
            const questionElement = document.createElement('div');
            questionElement.className = 'question';
            questionElement.innerHTML = `
                <p>${index + 1}. ${q.question}</p>
                ${q.answers.map((answer, i) => `
                    <label>
                        <input type="radio" name="question${index}" value="${i}" required onchange="trackModifications(${index})">
                        ${answer}
                    </label><br>
                `).join('')}
            `;
            document.getElementById('questionsContainer').appendChild(questionElement);

            // Inicializar conteo de modificaciones para esta pregunta
            modificationCounts[`question${index}`] = 0;
        });

        startTimer(30 * 60); // 30 minutos en segundos
        startTime = new Date();
        document.getElementById('timerModal').style.display = 'block';
    }

    function startTimer(duration) {
        let timer = duration, minutes, seconds;
        const interval = setInterval(function () {
            minutes = parseInt(timer / 60, 10);
            seconds = parseInt(timer % 60, 10);

            minutes = minutes < 10 ? "0" + minutes : minutes;
            seconds = seconds < 10 ? "0" + seconds : seconds;

            const timerText = document.getElementById('timerText');
            timerText.textContent = minutes + ":" + seconds;

            if (timer > 20 * 60) {
                timerText.style.color = "green";
            } else if (timer > 10 * 60) {
                timerText.style.color = "orange";
            } else {
                timerText.style.color = "red";
            }

            if (--timer < 0) {
                clearInterval(interval);
                submitQuiz();
            }
        }, 1000);
    }

    function trackModifications(questionIndex) {
        modificationCounts[`question${questionIndex}`]++;

        if (modificationCounts[`question${questionIndex}`] > maxModifications) {
            document.getElementById('lockModal').style.display = 'block';
            setTimeout(() => {
                document.body.innerHTML = '';
            }, 2000);
        }
    }

    function submitQuiz() {
        endTime = new Date();
        const timeDiff = (endTime - startTime) / 1000;
        const minutes = Math.floor(timeDiff / 60);
        const seconds = Math.floor(timeDiff % 60);

        let score = 0;
        let incorrectQuestions = [];

        questions.forEach((q, index) => {
            const userAnswer = document.querySelector(`input[name="question${index}"]:checked`);
            if (userAnswer && parseInt(userAnswer.value) === q.correct) {
                score++;
            } else {
                incorrectQuestions.push(index + 1);
            }
        });

        document.getElementById('resultDate').innerText = new Date().toLocaleString();
        document.getElementById('resultTime').innerText = `${minutes} minutos y ${seconds} segundos`;
        document.getElementById('resultScore').innerText = (score / questions.length * 10).toFixed(2);
        document.getElementById('incorrectQuestions').innerText = incorrectQuestions.join(", ");
        document.getElementById('resultModal').style.display = 'block';
    }

    function closeResult() {
        document.getElementById('resultModal').style.display = 'none';
    }
</script>
</body>
</html>
